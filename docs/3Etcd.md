# ETCD相关存储说明

>  Etcd 作为核心协调组件，存储了节点、任务、进程、锁等关键信息

## 节点相关键



| 键             | 格式                                    | 值                                                      |                         添加者                          |                           删除时机                           |
| -------------- | --------------------------------------- | ------------------------------------------------------- | :-----------------------------------------------------: | :----------------------------------------------------------: |
| 节点信息       | /Cronix/node/<node_uuid>                | 节点信息 JSON，包含 UUID、IP、端口、状态等              |             任务执行节点（节点启动时注册）              | 1.节点正常下线时主动删除；<br />2.发生故障时租约到期自动删除；<br /> |
| 进程信息       | /Cronix/proc/<node_uuid>/<job_id>/<pid> | 任务进程信息 JSON，包含进程 ID、任务 ID、是否终止等     |            任务执行节点（执行该任务时添加）             | 进程正常结束时主动删除；<br /> 进程意外退出时 TTL 过期自动删除；<br /> 任务终止时 Node 服务删除。 |
| 任务信息       | /Cronix/job/<node_uuid>/<job_id>        | 任务配置 JSON，包含 Cron 表达式、命令、重试策略等       |                        调度中心                         | 任务删除时调度中心主动删除；<br /> 任务更新（换节点）时 调度中心 删除旧节点路径键； <br />故障转移时删除原节点路径键。 |
| 一次性任务触发 | /Cronix/once/<job_id>                   | 目标节点 UUID（指定节点执行）或空字符串（所有节点执行） |                        调度中心                         |                    任务执行完成后主动清理                    |
| 分布式锁       | /Cronix/lock/<key>                      | 空字符串（通过键存在性表示锁状态）                      |                需要分布式锁的模块都可以                 |                       使用模块主动释放                       |
| 系统信息开关   | /Cronix/system/switch/<node_uuid>       | 节点系统信息收集标识                                    |                        调度中心                         |                调度中心获取节点信息后主动删除                |
| 系统信息数据   | /Cronix/system/get/<node_uuid>          | 节点系统信息 JSON，CPU、内存、磁盘等                    | 任务执行节点（监听开关后收集信息写入，绑定 5 分钟租约） |              租约过期自动删除（确保信息时效性）              |
|                |                                         |                                                         |                                                         |                                                              |
|                |                                         |                                                         |                                                         |                                                              |

